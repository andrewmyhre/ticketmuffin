@model GroupGiving.Web.Models.EventViewModel
@{
    ViewBag.Title = "Event";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section scripts {
    <script src="/Scripts/jquery.countdown.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#countdown').countdown({  
                until: new Date(
                            @Model.SalesEndDateTime.Year,
                            @Model.SalesEndDateTime.Month-1,
                            @Model.SalesEndDateTime.Day,
                            @Model.SalesEndDateTime.Hour,
                            @Model.SalesEndDateTime.Minute,
                            @Model.SalesEndDateTime.Second),
                layout: '<div class="timeBox">'+
              '<div class="name">DAYS</div>'+
              '<div class="number">{dn}</div>'+
            '</div>'+
            '<div class="timeBox">'+
              '<div class="name">HOURS</div>'+
              '<div class="number">{hn}</div>'+
            '</div>'+
            '<div class="timeBox">'+
              '<div class="name">MINS</div>'+
              '<div class="number">{mn}</div>'+
            '</div>'+
            '<div class="timeBox">'+
              '<div class="name">SECS</div>'+
              '<div class="number">{sn}</div>'+
            '</div>'
            });
        });
        
        
    </script>
}

<div id="eventPage">
        <div id="eventHead">
          <div id="eventDate">
            <div id="month">@Model.StartDate.ToString("MMMM")</div>
            <div id="day">@Model.StartDate.Day</div>
          </div>
          <div id="eventName"><h1>@Model.Title</h1></div>

          <div id="eventDetails">@Model.StartDate.ToString("HH:mm tt dddd MMMM dd, yyyy")<br />
          <strong>@Model.Venue</strong>, @Model.AddressLine, @Model.City, @Model.Country
          
          @{
              if (Model.UserIsEventOwner)
              {
                    <text>@Html.ActionLink("Edit this event", "edit-event", new { shortUrl = Model.ShortUrl })</text>
              }
              }</div>
          <div id="howItWorks">@Html.ActionLink("How it works", "HowItWorks", "Home")</div>
        </div>
        <div id="eventLeft">
        @if (!Model.EventIsFull && Model.SalesEndDateTime > DateTime.Now)
        {
          <div id="pledge">
            @using (Html.BeginForm("Pledge", "Event", FormMethod.Get))
            {
                <input type="submit" class="bigButton" value="@Model.TicketPrice.ToString("c") Pledge" />
            }
          </div>
        }
            @if (Model.SalesEndDateTime < DateTime.Now)
            {
              <div id="pledgeInfo">
                    <div id="count">Sales ended</div>    
                    <div id="countBar">
                        <div id="barProgress" style="width: @Model.RequiredPledgesPercentage%;"></div>
                    </div>
                    <div id="peopleInfo">@Model.PledgeCount people have pledged to attend the event</div>
                    <div id="countdown"></div>
                    <div class="clearFix"></div>
                    <div id="timeLeft">Time left to pledge</div>
              </div>
            }
            else
            {
              <div id="pledgeInfo">
                @if (Model.EventIsFull)
                {
                     <div id="count">Sold out!</div>    
                }
                else if (Model.EventIsOn)
                {
                        <div id="count">@(Model.MaximumParticipants - Model.PledgeCount)</div>

                        <div id="countInfo">Spaces left!</div>
                }
                else
                {
                        <div id="count">@(Model.MinimumParticipants - Model.PledgeCount)</div>

                        <div id="countInfo">Pledges needed to fund the event</div>
                }
                <div id="countBar">
                    <div id="barProgress" style="width: @Model.RequiredPledgesPercentage%;"></div>
                </div>
                <div id="peopleInfo">@Model.PledgeCount people have already pledged to attend the event</div>
                <div id="countdown"></div>
                <div class="clearFix"></div>
                <div id="timeLeft">Time left to pledge</div>
                </div>
            }

          <div id="shareBox">
            <div>Share with your friends</div>
          </div>
          <h2>Event details</h2>

          <div class="eventBox">
            <div class="eventBoxTop">Date, time</div>
            <div class="eventBoxBottom">
              @Model.StartDate.ToString("dddd, MMMM dd, yyyy")<br />
              at @Model.StartDate.ToString("HH.mm tt")
            </div>
          </div>
          <div class="eventBox">

            <div class="eventBoxTop">Location and address</div>
            <div class="eventBoxBottom">
            <div id="obszar_mapy" style="width: 240px; height: 200px;">Location</div>

<div id="location">

<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>

<script type="text/javascript"><!--
var mapa;
function inicjalizacja() {
    var latlng = new google.maps.LatLng(@Model.VenueLatitude,@Model.VenueLongitude);	
    var mojeUstawienia = {
        zoom: 16, 									
        center: latlng, 
        mapTypeId: google.maps.MapTypeId.ROADMAP 		
};

mapa = new google.maps.Map(document.getElementById("obszar_mapy"), mojeUstawienia);

var marker = new google.maps.Marker({
    position: latlng, 
    map: mapa,
    });
}

setTimeout("inicjalizacja()",1000);
// --></script>

</div>
              <strong>@Model.Venue</strong><br />
              @Model.AddressLine<br />
              @Model.City @Model.PostCode<br />
              @Model.Country
            </div>
          </div>
          <div class="eventBox">
            <div class="eventBoxTop">Organiser</div>

            <div class="eventBoxBottom">
              <strong>@Model.ContactName</strong><br /><br />   
              <input type="submit" class="smallButton" value="Contact" />
            </div>
          </div>
        </div>                                    
        <div id="eventRight">
          <div id="eventDesc">
            @Html.Raw(Model.DescriptionMarkedDown)
            @Html.Raw(Model.AdditionalBenefitsMarkedDown)
            <div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script><fb:comments href="@Request.Url" num_posts="1" width="680"></fb:comments>            
          </div>
        </div>

        <div class="clearFix"></div>  
      </div>