@using System.Globalization
@using TicketMuffin.Core.Domain
@using TicketMuffin.Web.Code
@model TicketMuffin.Web.Models.EventViewModel
@{
    ViewBag.Title = Model.Title + " - TicketMuffin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section scripts {
    <script src="/Scripts/jquery.countdown.min.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.validate.js" type="text/javascript"></script>
    <script src="/Scripts/event.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#countdown').countdown({  
                until: new Date(
                    @Model.SalesEndDateTime.Year,
                            @Model.SalesEndDateTime.Month-1,
                            @Model.SalesEndDateTime.Day,
                            @Model.SalesEndDateTime.Hour,
                            @Model.SalesEndDateTime.Minute,
                            @Model.SalesEndDateTime.Second),
                layout: '<div class="timeBox">'+
              '<div class="name">DAYS</div>'+
              '<div class="number">{dn}</div>'+
            '</div>'+
            '<div class="timeBox">'+
              '<div class="name">HOURS</div>'+
              '<div class="number">{hn}</div>'+
            '</div>'+
            '<div class="timeBox">'+
              '<div class="name">MINS</div>'+
              '<div class="number">{mn}</div>'+
            '</div>'+
            '<div class="timeBox">'+
              '<div class="name">SECS</div>'+
              '<div class="number">{sn}</div>'+
            '</div>'
            });
        });
        
        
    </script>
    <script type="text/javascript">        var switchTo5x = true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript" src="http://s.sharethis.com/loader.js"></script>
    <style type="text/css">
    .stpulldown-gradient
    {
    background: #E1E1E1;
    background: -moz-linear-gradient(top, #E1E1E1 0%, #A7A7A7 100%); /* firefox */
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#E1E1E1), color-stop(100%,#A7A7A7)); /* webkit */
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#E1E1E1', endColorstr='#A7A7A7',GradientType=0 ); /* ie */
    background: -o-linear-gradient(top, #E1E1E1 0%,#A7A7A7 100%); /* opera */
    color: #636363;
    }
    #stpulldown .stpulldown-logo
    {
    height: 40px;
    width: 300px;
    margin-left: 20px;
    margin-top: 5px;
    background:url("http://www.ticketmuffin.com/content/img/logo.png") no-repeat;
    }
    </style>
}


<div id="eventPage">
    <div id="eventHead">
        @if (Model.State != EventState.Cancelled)
        {
            <div id="eventDate">
                <div id="month">@Model.StartDate.ToString("MMMM", new CultureInfo(Html.CurrentCulture()))</div>
                <div id="day">@Model.StartDate.Day</div>
            </div>
        }
                
        <div id="eventName"><h1>@Model.Title</h1></div>

        @if (Model.State != EventState.Cancelled)
        {
            <div id="eventDetails">@Model.StartDate.ToString(Html.Content("dddd, MMMM dd yyyy @ HH:mm tt").ToString(), Html.CultureDateTimeFormat())<br />
                @Model.Venue, @Model.AddressLine, @Model.City, @Model.Country
            </div>
        }
        <div id="howItWorks"><a href="@Url.Action("HowItWorks", "Home")">@Html.Content("How it works")</a></div>

        @if (Model.UserIsEventOwner)
        {
            <div id="manageEvent">
                <a href="@Url.Action("edit-event", new { shortUrl = Model.ShortUrl })">@Html.Content("Edit this event")</a>
                <a href="@Url.Action("management-console", new {shortUrl = Model.ShortUrl})">@Html.Content("Go to the event management console")</a>
            </div>
        }
    </div>
    <div id="eventLeft">
            

        @{ Html.RenderPartial("PledgeWidget"); }
        <h2>@Html.Content("Event details")</h2>

        @if (Model.Charity != null)
        {
            <div class="eventBox">
                @{Html.RenderPartial("CharityDetails", Model.Charity);}
            </div>
        }
                
        <div class="eventBox">
            @{ Html.RenderPartial("EventDateDetails"); }
        </div>
        <div class="eventBox">
            @{ Html.RenderPartial("EventLocationDetails"); }
        </div>
        <div class="eventBox">
            @{ Html.RenderPartial("EventOrganiserDetails"); }
        </div>
    </div>                                    
    <div id="eventRight">
        <!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style addthis_32x32_style">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">    var addthis_config = { "data_track_addressbar": true };</script>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=ra-5005bb134486a2c5"></script>
<!-- AddThis Button END -->

        <div id="eventDesc">
            <div class="imageContainer">
                <img src="@Model.ImageUrl"/>
            </div>

            @Html.Raw(Model.DescriptionMarkedDown)
            @Html.Raw(Model.AdditionalBenefitsMarkedDown)
            <div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script><fb:comments href="@Request.Url" num_posts="1" width="680"></fb:comments>            
        </div>
    </div>

    <div class="clearFix"></div>  
</div>

<script>
    var options = { "publisher": "b71b30b7-320f-4d02-bb39-583207e1d30f", "scrollpx": 50, "ad": { "visible": false }, "chicklets": { "items": ["facebook", "twitter", "linkedin", "email"]} };
    var st_pulldown_widget = new sharethis.widgets.pulldownbar(options);
</script>